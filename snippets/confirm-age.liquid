{%- style -%}
  age-verification {
    --color: #fffef7;
    --bg: #022541;
    --btn-color: #022541;
    --btn-bg: #fff;
    --btn-border: #fffef7;
  }
{%- endstyle -%}
<age-verification
  class="fixed inset-0 block z-20 text-[color:var(--color)] bg-[color:var(--bg)]"
>
  <div class="container xl:container h-full py-4 lg:pt-0 lg:pb-1">
    <div class="col-span-full h-full grid grid-rows-[auto,1fr]">
      <div class="text-center mx-auto">
        {%- liquid
          assign height = 1440 | divided_by: settings.secondary_logo.aspect_ratio
          assign alt = settings.secondary_logo.alt | default: shop.name
          assign height_mobile = 277 | divided_by: settings.settings.secondary_logo_mobile.aspect_ratio
          assign alt_mobile = settings.secondary_logo_mobile.alt | default: shop.name
        -%}
        {{
          settings.secondary_logo
          | image_url: width: 1440
          | image_tag: class: 'hidden lg:block', height: height, width: 1440, alt: alt, preload: true
        }}
        {{
          settings.secondary_logo_mobile
          | image_url: width: 277
          | image_tag: class: 'lg:hidden', height: height_mobile, width: 277, alt: alt_mobile, preload: true
        }}
      </div>
      <div class="flex flex-col justify-center gap-y-9 lg:gap-y-4">
        <div class="font-serif w-full max-w-[78rem] mx-auto text-center big-text lg:text-3xl -tracking-[.05em]">
          Please confirm you are 21<br>
          years of age or older.
        </div>
        <div class="w-full max-w-[55rem] mx-auto flex flex-wrap justify-center gap-2">
          <button
            id="accept"
            class="
              font-sans text-[2rem] leading-[2.2rem] -tracking-[.02em] uppercase
              px-[3.6rem] py-[1.55rem] border rounded-3xl
              bg-[color:var(--btn-bg)] border-[color:var(--btn-border)] text-[color:var(--btn-color)]
              min-w-[26.2rem]
            "
          >
            yes
          </button>
          <button
            id="refuse"
            class="
              font-sans text-[2rem] leading-[2.2rem] -tracking-[.02em] uppercase
              px-[3.6rem] py-[1.55rem] border rounded-3xl
              bg-[color:var(--btn-bg)] border-[color:var(--btn-border)] text-[color:var(--btn-color)]
              min-w-[26.2rem]
            "
          >
            no
          </button>
        </div>
      </div>
    </div>
  </div>
</age-verification>
<script>
  class ageVerification extends HTMLElement {
    constructor() {
      super();
      this.cName = 'isAdalt';
      this.cValue = 'yes';
      this.cookieFound = this.checkCookie(this.cName);
      this.redirectUrl = '/collections/frontpage';
      this.redirectPage = window.location.href.indexOf(this.redirectUrl) !== -1;

      console.log(this.redirectPage);
      if (!this.cookieFound && !this.redirectPage && !Shopify.designMode) {
        this.showPopup();
      } else {
        this.closePopup();
      }
      this.querySelector('#accept').addEventListener('click', this.acceptButtonHandler.bind(this));
      this.querySelector('#refuse').addEventListener('click', this.refuseButtonHandler.bind(this));
    }

    acceptButtonHandler() {
      this.setCookie(this.cName, this.cValue);
      this.closePopup();
    }

    refuseButtonHandler() {
      this.redirect();
      this.closePopup();
    }

    setCookie(cName, cValue) {
      const days = 14;
      const expires = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toUTCString();
      document.cookie = `${cName}=${cValue};${expires};path=/`;
    }

    redirect() {
      this.redirectUrl ? (window.location = this.redirectUrl) : (window.location = 'https://www.google.com/');
    }

    checkCookie(name) {
      return document.cookie.split(';').some((item) => item.trim().startsWith(`${name}=`));
    }

    showPopup() {
      this.classList.add('block');
      if (this.classList.contains('hidden')) this.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
    }

    closePopup() {
      this.classList.add('hidden');
      if (this.classList.contains('block')) this.classList.remove('block');
      if (document.body.classList.contains('overflow-hidden')) document.body.classList.remove('overflow-hidden');
    }
  }

  customElements.define('age-verification', ageVerification);
</script>
